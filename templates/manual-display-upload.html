<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manual Upload</title>
    <link href="./../static/css/main.css" rel="stylesheet" />
  </head>
  <body>
    <header class="header">
      <!-- Left logo -->
      <img src="./../static/images/pup-logo.png" alt="PUP Logo" />

      <!-- Center text -->
      <div class="center-text">INSTAPRINT</div>

      <!-- Right logo -->
      <img src="./../static/images/cpe-logo.png" alt="CPE Logo" />
    </header>

    <main>
      <div class="upload-area">
        <h2>Choose File to Upload</h2>
        <form action="/upload" method="POST" enctype="multipart/form-data">
          <label for="fileInput" class="custom-file-label">
            <img src="./../static/images/upload-icon.png" alt="Upload" />
          </label>
          <input
            type="file"
            id="fileInput"
            name="file"
            accept=".jpg,.jpeg,.png,.pdf,.doc,.docx"
            hidden
            required
          />
          <input
            type="text"
            id="fileName"
            placeholder="Selected file"
            readonly
          />

          <div class="button-container">
            <button id="exitButton" class="action-button" type="button">
              Exit
            </button>
            <button id="continueButton" class="action-button" type="submit">
              Upload
            </button>
          </div>
        </form>
      </div>

      <div class="uploaded-file">
        <div class="file-box">
          {% for file in files %}
          <div class="file-entry">
            {% if file.endswith('.pdf') %}
            <img
              src="{{ url_for('static', filename='images/pdf.png') }}"
              alt="PDF Icon"
            />
            {% elif file.endswith('.doc') or file.endswith('.docx') %}
            <img
              src="{{ url_for('static', filename='images/microsoftword.png') }}"
              alt="Word Icon"
            />
            {% elif file.endswith('.jpg') or file.endswith('.jpeg') or
            file.endswith('.png') %}
            <img
              src="{{ url_for('static', filename='images/file-upload.png') }}"
              alt="Image Icon"
            />
            {% else %}
            <img
              src="{{ url_for('static', filename='images/file-icon.png') }}"
              alt="File Icon"
            />
            {% endif %}
            <a
              href="{{ url_for('uploaded_file', filename=file) }}"
              target="_blank"
              >{{ file }}</a
            >
          </div>
          {% endfor %}
        </div>
      </div>
    </main>

    <!-- Modal Structure -->
    <!-- First Modal -->
    <div id="myModal" class="modal">

      <div class="modal-content">
        
        <h2>FILE SELECTED</h2>
        <img src="./../static/images/pdf.png" alt="PDF" class="modal-pdf">
        <p>filename.pdf</p>
        <p class="p-modal">DO YOU WANT TO PROCEED?</p>

        <div class="button-container">
          <button class="exit">EXIT</button>
          <button class="yes">YES</button>
        </div>

      </div>

    </div>

    <!-- Second Modal -->
    <div id="newModal" class="modal">

      <div class="modal-content">

        <!-- Flexbox container for columns -->
        <div class="modal-columns">

          <div class="column1">

            <h3>PAGE RANGE</h3>

            <form>

              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;Current Page
              </label>
              
              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;All Pages
              </label>
              
              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;Custom Range
              </label>

            </form>

          </div>

          <div class="column2">

            <h3>PAPER SIZE</h3>

            <form>

              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;Letter
              </label>
              
              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;Legal
              </label>
              
              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;A4
              </label>
            
            </form>

          </div>

          <div class="column3">
            
            <h3>COLOR OPTIONS</h3>
            
            <form>

              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;Colored
              </label>
              
              <label>
                <input type="radio" name="option" id="checkbox1"/> &nbsp;Grayscale
              </label>
            
            </form>

          </div>

        </div>

        <div>

          <button class="close-second-modal">EXIT</button>
          <button class="continue">CONTINUE</button>

        </div>

      </div>

    </div>

    <script>
      // JavaScript for updating file input label
      const fileInput = document.getElementById("fileInput");
      const fileNameInput = document.getElementById("fileName");

      fileInput.addEventListener("change", () => {
        if (fileInput.files.length > 0) {
          fileNameInput.value = Array.from(fileInput.files)
            .map((file) => file.name)
            .join(", ");
        } else {
          fileNameInput.value = "";
        }
      });

      // MODAL
      // Get modal elements
      const myModal = document.getElementById("myModal");
      const newModal = document.getElementById("newModal");

      // Get the buttons inside the modals
      const exitButton = document.querySelector(".exit");
      const yesButton = document.querySelector(".yes");
      const closeSecondModalButton = document.querySelector(".close-second-modal");

      // Get the file images and file links
      const fileEntries = document.querySelectorAll(".file-entry img");
      const fileLinks = document.querySelectorAll(".file-entry a");

      // Function to open the first modal
      function openModal(fileName) {
        myModal.style.display = "block";
        // Update the modal content
        const modalImage = myModal.querySelector(".modal-pdf");
        const modalText = myModal.querySelector("p");
        
        // Set the file name and icon
        modalImage.src = "./../static/images/pdf.png"; // or other icon depending on the file type
        modalText.textContent = fileName;
      }

      // Event listeners for file icons and links to open the modal
      fileEntries.forEach(img => {
        img.addEventListener("click", () => {
          const fileName = img.closest(".file-entry").querySelector("a").textContent;
          openModal(fileName);
        });
      });

      fileLinks.forEach(link => {
        link.addEventListener("click", () => {
          const fileName = link.textContent;
          openModal(fileName);
        });
      });

      // Event listener for "EXIT" button to close the first modal
      exitButton.addEventListener("click", () => {
        myModal.style.display = "none";
      });

      // Event listener for "YES" button to open the second modal
      yesButton.addEventListener("click", () => {
        myModal.style.display = "none";
        newModal.style.display = "block";
      });

      // Event listener for "EXIT" button in second modal
      closeSecondModalButton.addEventListener("click", () => {
        newModal.style.display = "none";
      });

      // Optionally, close modals when clicking outside of them
      window.addEventListener("click", (event) => {
        if (event.target === myModal || event.target === newModal) {
          myModal.style.display = "none";
          newModal.style.display = "none";
        }
      });

      // CLEAR RADIO SELECTIONS
      // Get the "EXIT" button
      var closeSecModButton = document.querySelector(".close-second-modal");

      // Get all the radio buttons within the modal
      var radioButtons = document.querySelectorAll('input[type="radio"]');

      // Add event listener to the "EXIT" button
      closeSecondModalButton.onclick = function() {
      // Reset all the radio buttons when "EXIT" is clicked
        radioButtons.forEach(function(radio) {
          radio.checked = false;
        });

        // Close the modal
        newModal.style.display = "none";
      };

    </script>
  </body>
</html>
